{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="p-4 pb-24">
    <div class="mb-4">
        <h1 class="text-xl font-bold text-gray-800">Attendance Dashboard</h1>
        <p class="text-gray-600">{{ today_display }}</p>
    </div>
    
    <!-- Summary Cards -->
    <div class="grid grid-cols-2 gap-3 mb-6">
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
            <div class="text-2xl font-bold text-blue-700">{{ submitted_count }}/{{ total_groups }}</div>
            <div class="text-sm text-blue-600">Submitted</div>
        </div>
        <div class="bg-amber-50 border border-amber-200 rounded-lg p-3">
            <div class="text-2xl font-bold text-amber-700">{{ pending_count }}</div>
            <div class="text-sm text-amber-600">Pending</div>
        </div>
    </div>
    
    <!-- Classes List - sorted by status -->
    <div class="space-y-2">
        {% for group in groups %}
        {% set has_absent = group.absent_count and group.absent_count > 0 %}
        {% set is_fully_captured = has_absent and group.captured_count == group.absent_count %}
        {% set is_all_present = group.attendance_id and not has_absent %}
        {% set is_done = is_fully_captured or is_all_present %}
        
        {% if group.attendance_id %}
        <a href="{{ url_for('admin.class_detail', attendance_id=group.attendance_id) }}" 
           class="block rounded-lg p-3 shadow-sm border {% if is_done %}bg-gray-50 border-gray-200 opacity-60{% else %}bg-white border-green-300{% endif %}">
        {% else %}
        <div class="bg-white rounded-lg p-3 shadow-sm border border-amber-300">
        {% endif %}
            <div class="flex justify-between items-center">
                <div>
                    <span class="font-medium {% if is_done %}text-gray-500{% else %}text-gray-800{% endif %}">{{ group.group_name }}</span>
                    <span class="text-gray-400 text-sm ml-2">{{ group.mentor_name or 'No mentor' }}</span>
                </div>
                {% if group.attendance_id %}
                <div class="flex items-center gap-1">
                    <span class="inline-block min-w-[24px] px-1.5 py-0.5 text-xs font-medium rounded bg-green-100 text-green-700 text-center">{{ group.present_count }}</span>
                    <span class="inline-block min-w-[24px] px-1.5 py-0.5 text-xs font-medium rounded bg-red-100 text-red-700 text-center">{{ group.absent_count }}{% if group.captured_count and not is_done %}<sup>{{ group.captured_count }}</sup>{% endif %}</span>
                    <span class="inline-block min-w-[24px] px-1.5 py-0.5 text-xs font-medium rounded bg-amber-100 text-amber-700 text-center">{{ group.late_count }}</span>
                    {% if is_done %}<span class="text-xs text-gray-400 ml-1">âœ“</span>{% endif %}
                </div>
                {% else %}
                <span class="text-amber-600 text-xs font-medium">â³ Pending</span>
                {% endif %}
            </div>
        {% if group.attendance_id %}
        </a>
        {% else %}
        </div>
        {% endif %}
        {% endfor %}
    </div>
    
    <!-- Refresh -->
    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200">
        <button onclick="location.reload()" class="w-full py-3 px-4 rounded-xl font-semibold text-gray-700 bg-gray-100 hover:bg-gray-200">
            ğŸ”„ Refresh Dashboard
        </button>
    </div>
</div>
{% endblock %}
